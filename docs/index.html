<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pure Data for logue SDK: Tutorial</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Pure Data for logue SDK: Tutorial</h1>
    <p><em>This site is currently under development.</em></p>
    <p>Let's start from easy-to-understand examples.</p>
  </header>

  <main class="gallery">
    <div class="card">
      <h2>Simple 440Hz tone generator</h2>
        <img src="pdimg/osc440.png" alt="osc440">
        <div class="col"><a href="pd/osc440.pd">osc440.pd</a></div>
        <div class="col transport">
          <label>
            start / stop
            <input type="checkbox" id="transportButton" onchange="toggleTransport();">
          </label>
        </div>
        <div>
          <button style="padding: 10px;" type="button" id="randomiseButton" onclick="randomiseParameters();">Randomise</button>
        </div>
      </div>

      <div class="row events" style="text-align: center;">
      </div>
    </div>
  </main>

  <footer>
    <p>Created by boochow instruments Â· Powered by hvcc WebAudio</p>
  </footer>

    <script type="application/javascript" src="./osc440.js"></script>

    <script type="text/javascript">
      var heavyModule = null;
      var loader = null;
      midioutPort = null;

      window.onload = function() {
        osc440_Module().then(loadedModule => {
          heavyModule = loadedModule;
          moduleLoaded();
        });
        document.getElementById("transportButton").style.visibility = "hidden";
      }

      function moduleLoaded() {
        loader = new heavyModule.AudioLibLoader();
        document.getElementById("transportButton").style.visibility = "visible";
      }

      function start() {
        if(!loader.webAudioContext) {
          loader.init({
            // optional: set audio processing block size, default is 2048
            blockSize: 2048,
            // optional: provide a callback handler for [print] messages
            printHook: onPrint,
            // optional: provide a callback handler for [s {sendName} @hv_param] messages
            // sendName "midiOutMessage" is reserved for MIDI output messages!
            sendHook: onSendMessage,
            // optional: pass an existing web audio context, otherwise a new one
            // will be constructed.
            webAudioContext: null
          }).then(() => {
            });
        }
        loader.start();
      }

      function stop() {
        loader.stop();
      }

      function toggleTransport(element) {
        (loader.isPlaying) ? stop() : start();
      }

      function onPrint(message) {
        console.log(message);
      }
      
      

      function onMidiOutMessage(message) {
        if (midioutPort !== null) {
          midioutPort.send(message);
        }
        else {
          console.error("No MIDI output port available.");
        }
      }

      function onSendMessage(sendName, message) {

        switch (sendName) {
          case "midiOutMessage":
            onMidiOutMessage(message);
            break;
          default:
            console.log(sendName, message);
        }
      }


              // randomizer
              function randomiseParameters() {
              }
    </script>
</body>
</html>
